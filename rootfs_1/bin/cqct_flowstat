#! /bin/sh

if [ $# -ne 1 ]; then
    echo "ERROR::input para is not right!"
    exit
fi

if [ "$1" == "pon" ]; then
    ampqoe flowstat $1
    exit
fi

if [ "$1" = "wlan" -o "$1" = "wlan5g" ]; then
    let ssidnum=2*$(cat /proc/wap_proc/spec | grep -w AMP_SPEC_SSID_NUM_MAX_BAND | awk '{ FS = " " } ; { printf $4 }')
    let ByteSend=0
    let ByteRece=0
    let channel=0
    let start=1
    let end=14
    if [ "$1" = "wlan5g" ]; then
        let start=36
        let end=165
    fi

    for i in $(seq 1 $ssidnum)
    do
        channel=$(cwmp getvalue InternetGatewayDevice.LANDevice.1.WLANConfiguration.${i}.ChannelsInUse | awk -F"[=]" '{ printf $2 }')
        if [ -z $channel ] ; then
            continue
        fi

        if [ $channel -lt $start -o $channel -gt $end ] ; then
            continue
        fi

        let ByteSend+=$(cwmp getvalue InternetGatewayDevice.LANDevice.1.WLANConfiguration.${i}.TotalBytesSent | awk -F"[=]" '{ printf $2 }')
        let ByteRece+=$(cwmp getvalue InternetGatewayDevice.LANDevice.1.WLANConfiguration.${i}.TotalBytesReceived | awk -F"[=]" '{ printf $2 }')
    done
    echo "$ByteRece $ByteSend"
    exit
fi

lannumline=$(cwmp getvalue InternetGatewayDevice.LANDevice.1.LANEthernetInterfaceNumberOfEntries)
lannum=${lannumline##*LANEthernetInterfaceNumberOfEntries=}
for i in $(seq 1 $lannum)
do
    if [ "$1" == "lan${i}" ]; then
        lanflag=1
        break
    fi
done
if [ -z "$lanflag" ]; then
    echo "ERROR::input para is not right!"
    exit
fi

varpara=$1
lanportline=$(shellconfig InternetGatewayDevice.X_HW_DEBUG.AMP.LANPort.${varpara:3}.CommonConfig get)
lanstatusline=`echo "$lanportline" | sed -n '/Link:/p'`
lanstatus=${lanstatusline##*Link:}
if [ $lanstatus -eq 0 ]; then
	echo "0  0"
else
	ampqoe flowstat $1
fi
