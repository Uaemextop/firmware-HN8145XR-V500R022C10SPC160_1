#!/bin/sh

opt_O=""
opt_P=""
https_URL=""

paras()
{
	nargs=$# 
	GETOPT_ARGS=`getopt -o scqP:O:U:Y: -al output-document: -- "$@"`
	eval set -- "$GETOPT_ARGS"

	result=$? 
	if [ $nargs -eq 0 ] || [ $result != 0 ] ; then
		exit
	fi

	#获取参数
	while [ -n "$1" ]
	do
		case "$1" in
			-O|--output-document) opt_O=$2; shift 2;;
			-P) opt_P=$2; shift 2;;
			--) shift ;;
			*) tmp_url=$1 ;
				tmp_url=${tmp_url:0:5};
				if [ $tmp_url = "https" ]; then
				https_URL=$1
				fi;
				shift ;;
		esac
	done
}

busybox wget "$@"

result=$? 
if [ $result == 0 ] ; then
	exit
fi


paras "$@"

if [ $https_URL ]; then
	https_URL=${https_URL:8}
	hostport="https://"${https_URL%%/*}
	remote_path="/"${https_URL#*/}
	echo "hostport" is $hostport	
	echo "remote_path" is $remote_path
	
	if [ -z $opt_O ]; then
		local_path=$opt_P$remote_path
	else
		local_path=$opt_O
	fi

	httpc -h -l $local_path -r $remote_path $hostport
fi
